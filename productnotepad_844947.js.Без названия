!function(t,e){"use strict";"function"==typeof define&&define.amd?define("productNotepad",["jquery","productNotepad"],e):t.Wishlist=e(t.jQuery)}(this,function(t,e){"use strict";function i(e,o){return e.preventDefault(),e.stopImmediatePropagation(),wishlist.notepad.products.forEach(function(e){t("<input />").attr("type","hidden").attr("name","id").val(e.id).appendTo(".modalOverlay form#wishListMailForm")}),u.trackEvent("Produkte","Senden","Merkzettel",""),t.ajax({type:t(o).attr("method"),url:t(o).attr("action"),data:t(o).serialize(),success:function(e){p.restoreSendBox(),t(".modalOverlay .overlayContent").addClass("successBox"),t("form#wishListMailForm").trigger("reset"),t("form#wishListMailForm").submit(function(t){i(t)})},error:function(){t(".modalOverlay .overlayContent ").addClass("errorBox")},timeout:function(){t(".modalOverlay .overlayContent ").addClass("errorBox")}}),!1}var o,n,a,s=t("#servicebar"),r=t("body"),l=require("productCompare"),d={$serviceBarWishlist:s.find(".wishlist"),$serviceBarCounter:s.find(".wishlist .flag"),$sbProductCounter:s.find(".sbProductCounter"),$sbProductPlural:s.find(".sbProductPlural"),$assortmentPopup:s.find(".assortmentNotify"),$notepadContainer:t(".wlContainer"),$notepadArea:t(".memo .memorize"),$assortment:t('meta[property="assortment"]').attr("content"),productsUrl:s.find(".wishlist").data("service-url"),productListContent:document.createDocumentFragment()},c=t("#wishListContainer .wishlist_product_item").clone(),u={readList:function(t){null===localStorage.getItem(t)?wishlist.notepad={products:[]}:wishlist.notepad=JSON.parse(localStorage.getItem(t))},assortmentPopup:function(){if(d.$assortmentPopup.length>0){var e=d.$assortmentPopup,i=t(".meta_navigation #country option:selected").html();e.find("strong").html(i),e.fadeIn("slow",function(){e.delay(3e3).fadeOut("slow")})}},trackEvent:function(t,e,i,o){try{window.trackingGoogle.trackEvent(t,e,i)}catch(t){}},initResponsiveToggle:function(){var e=t(".filter_module"),i=t(".servicebarNav .container_24");e.hasClass("responsive")&&t('<ul class="serviceUl mobile"><li class="tab5 tabWrapper toggle-filter"><span title="titletext" class="font-icon-settings">&nbsp;</span></li></ul>').appendTo(i)}},p={init:function(){if(o=this,window.wishlist=window.wishlist||{},wishlist.notepad=wishlist.notepad||[],u.readList("notepad"),u.assortmentPopup(),u.initResponsiveToggle(),o.updateButtons(),d.$notepadContainer.length&&(wishlist.notepad.products.length>0?t.when(o.getProductList()).then(function(){o.printProductList(),o.initWishlistHandlers()}):(a={},o.printProductList(),o.initWishlistHandlers()),d.wishlistFormBox=t("#send_mail").clone()),d.$serviceBarWishlist.length)return m.init()},reInit:function(){if(u.readList("notepad"),o.updateButtons(),d.$notepadContainer.length&&(wishlist.notepad.products.length>0?t.when(o.getProductList()).then(function(){o.printProductList()}):(a={},o.printProductList())),d.$serviceBarWishlist.length)return m.reInit()},reInitAjaxContent:function(e){d.$notepadArea=t(".memo .memorize"),u.readList("notepad"),o.updateButtons(e),m.initClickHandlersAjaxContent()},getProductList:function(){var e="?";return wishlist.notepad.products.forEach(function(t){e+="id="+t.id+"&"}),e=e.slice(0,-1),t.ajax({url:d.productsUrl+e,dataType:"json",contentType:"application/json",success:function(t){a=t;for(var e=null,i=wishlist.notepad.products?wishlist.notepad.products.length:0,o=0;o<a.length;o++){e=!1;for(var n=0;n<i;n++)if(JSON.stringify(wishlist.notepad.products[n].id)===JSON.stringify(a[o].unique_product_id)){a[o].savedAssortment=wishlist.notepad.products[n].assortment,e=!0;break}!1===e&&a.splice(o--,1)}},error:function(t){}})},printProductList:function(){if(0==a.length||void 0==a.length)d.$notepadContainer.addClass("empty").removeClass("filled");else{var e;t(".wlCount span").text(a.length),a.forEach(function(i){e=c.clone();var o=i.display_name;i.display_name_sub&&(o+="<em>"+i.display_name_sub+"</em>"),e.attr("data-product-id",i.unique_product_id),e.attr("data-compare-id",i.product_compare_id),e.find(".product-comparison-toggle").attr("data-product-id",i.unique_product_id).attr("data-compare-id",i.product_compare_id),null!==i.comparable&&!1===i.comparable&&e.remove(".product-comparison-toggle"),e.find(".wlProduct_title").html(o).attr("href",i.detail_page),e.find(".wlProduct_image").attr("title",i.display_name).attr("href",i.detail_page).find("img").attr("src",i.image_url).attr("alt",i.display_name),e.find(".button.showDetails").attr("href",i.detail_page),e.find(".range_value strong").html(t("#country option#"+i.savedAssortment).html());for(var n=document.createDocumentFragment(),a=0;a<i.teasers.length;a++){var s="";if(i.teasers[a].tooltip&&null!=i.teasers[a].tooltip&&(s=e.find(".toolTipLink").clone(),t(".toolTipInner .text",s).text(i.teasers[a].tooltip),s=s[0].outerHTML),document.cookie.indexOf("metric=metric")>=0&&"metric"===i.teasers[a].metricFilterRelevance||document.cookie.indexOf("metric=imperial")>=0&&"imperial"===i.teasers[a].metricFilterRelevance||-1===document.cookie.indexOf("metric=")||"none"===i.teasers[a].metricFilterRelevance){var r=document.createElement("tr"),l=document.createElement("td"),u=document.createElement("td");l.setAttribute("class","wlProductDataTitle"),l.innerHTML=i.teasers[a].label+s,u.setAttribute("class","wlProductDataContent"),u.innerHTML=i.teasers[a].value,r.appendChild(l),r.appendChild(u),n.appendChild(r)}}e.find(".wlProduct_data").html(n),i.hasOwnProperty("marketingFlagImagePath")?e.find(".novelty").attr("src",i.marketingFlagImagePath+window.location.pathname.split("/")[1]+".png"):e.find(".novelty").remove(),t.inArray(d.$assortment,i.assortments)>=0||1==i.visible?e.find(".notAvailableNotice").remove():e.addClass("notAvailable"),t(d.productListContent).append(e)}),t("#wishListContainer").html(t(d.productListContent)),d.$notepadContainer.removeClass("empty").addClass("filled")}l.update()},getProductData:function(e){var i=t(e).closest(".memo");return{name:i.data("product-name"),id:i.data("product-id"),link:i.data("product-link"),thumbnail:i.data("product-thumbnail"),country:i.data("product-country"),assortment:t("#country option:selected").attr("id")}},addToList:function(t){if(t&&void 0!==t){t.timestamp=Date.now();var e=!1;0==wishlist.notepad.products.length?u.trackEvent("Produkte","Neu","Merkzettel",""):wishlist.notepad.products.forEach(function(i){if(JSON.stringify(i.id)===JSON.stringify(t.id))return e=!0,!1}),e||(wishlist.notepad.products.push(t),localStorage.setItem("notepad",JSON.stringify(wishlist.notepad)),o.triggerWishlistChange(),o.triggerWishlistAdd(),u.trackEvent("Produkte","Hinzuf√ºgen","Merkzettel",""))}},deleteFromList:function(t){var e=!1;wishlist.notepad.products.forEach(function(i){if(JSON.stringify(i.id)===JSON.stringify(t))return e=!0,!1});for(var i=0;i<wishlist.notepad.products.length;i++)JSON.stringify(wishlist.notepad.products[i].id)===JSON.stringify(t)&&(wishlist.notepad.products.splice(i--,1),e=!0);localStorage.setItem("notepad",JSON.stringify(wishlist.notepad)),o.triggerWishlistChange(),o.updateButtons()},clearList:function(){wishlist.notepad=[],delete localStorage.notepad,t("#wishListContainer").html(""),o.triggerWishlistChange(),o.triggerWishlistClear()},updateButtons:function(e){var i;i=void 0!==e?t(e).find(".memorize"):d.$notepadArea,i.each(function(){var e=t(this).closest(".memo"),i=e.find(".memorable"),o=e.find(".memorized"),n=JSON.stringify(e.data("product-id")),a=!1;wishlist.notepad.products.forEach(function(t){if(JSON.stringify(t.id)===n)return a=!0,!1}),a?(o.show(),i.hide()):(o.hide(),i.show())})},showPopupEvent:function(){var t=new CustomEvent("servicebar_new_popup");window.dispatchEvent(t)},deleteWishlistItem:function(e,i){var n=i.closest(".wishlist_product_item");e.preventDefault(),i.closest(".itemNav").fadeOut(500),o.deleteFromList(i.closest(".wishlist_product_item").data("product-id")),n.slideUp(1e3,function(){t(this).remove()})},initWishlistHandlers:function(){t(".wlNav").on("click touchstart",".clearWishlist",function(t){t.preventDefault(),p.clearList()}),t(".wlNav .product-comparison-all").on("click",function(e){var i=t(this),o=t("#wishListContainer .wishlist_product_item").not(".notAvailable"),n={};t.each(o,function(e,i){var o=t(i).attr("data-compare-id"),a=t(i).attr("data-product-id");n.hasOwnProperty(o)?n[o]=n[o].concat([a]):n[o]=[a]});var a=null;if(i.hasClass("compare")?(a="pcomp_add",u.trackEvent("Memo List","AddAllToProductComparison",n),t(".wlNav .product-comparison-all").removeClass("compare").addClass("uncompare").find(".text").html(i.attr("data-compared-text"))):i.hasClass("uncompare")&&(u.trackEvent("Memo List","RemoveAllFromProductComparison",n),a="pcomp_delete",t(".wlNav .product-comparison-all").removeClass("uncompare").addClass("compare").find(".text").html(i.attr("data-compare-text"))),a){var s=new CustomEvent(a,{detail:n});window.dispatchEvent(s)}}),t("#wishListContainer").on("click touchstart",".deleteWishlistItem",function(e){p.deleteWishlistItem(e,t(this))}),t("#wishListContainer").on("mouseenter touchstart",".notAvailable",function(e){e.preventDefault(),t(this).find(".notAvailableNotice").fadeIn(300)}).on("mouseleave touchend",".notAvailable",function(e){e.preventDefault(),t(this).find(".notAvailableNotice").fadeOut(300)})},restoreSendBox:function(){t("#popupContainer").html(d.wishlistFormBox.clone())},storageEventNotebookCheck:function(t){t=t||window.event,"notepad"==t.key&&o.triggerWishlistChange()},triggerWishlistChange:function(){var e=new CustomEvent("memo_change");window.dispatchEvent(e),t.event.trigger({type:"changeWishlist",message:"Wishlist has been changed.",time:new Date})},triggerWishlistAdd:function(){t.event.trigger({type:"productToWishlist",message:"New product added to wishlist.",time:new Date})},triggerWishlistDelete:function(){t.event.trigger({type:"productRemoveFromWishlist",message:"Product deleted from wishlist.",time:new Date})},triggerWishlistClear:function(){t.event.trigger({type:"clearWishlist",message:"Wishlist has been cleared.",time:new Date})}},m={init:function(){n=this,n.updateWishlistBar(),n.initServicebarHandlers()},reInit:function(){n.updateWishlistBar()},populateShortlist:function(e){if(0!=e){var i=wishlist.notepad.products.sort(function(t,e){return parseFloat(e.timestamp)-parseFloat(t.timestamp)}),o=t(".tpl_notAvailableNotice").html(),n=1,a=t("#wlProduct"+n);t.each(i,function(){var e="notepadItem",i="";-1==this.country.indexOf(d.$assortment)&&(e+=" notAvailable",i=o);var s=document.createElement("li");if(s.className=e,s.id=a.attr("id"),s.innerHTML='<a href="'+this.link+'"><div class="wlImage"><img src="'+this.thumbnail+'" alt="Produktbild" title="'+this.name+'" />'+i+'</div><div class="wlTitle">'+this.name+'</div></a><div class="wlDelete" data-product-id="'+this.id+'"><span class="font-icon-remove"></span></div>',a.replaceWith(s),++n>4)return!1;a=t("#wlProduct"+n)})}var s=n||1;if(s<=4)for(var r=s;r<=4;r++)a=t("#wlProduct"+r),a.html('<div class="wlImage"></div>')},closeServicebar:function(t){r.removeClass("servicebar-visible"),s.find(".servicebarContent").slideUp(300,function(){s.removeClass("open")})},openServicebar:function(t){r.addClass("servicebar-visible"),s.addClass("open").find(".servicebarContent").slideDown(300)},updateWishlistBar:function(){var t=wishlist.notepad.products?wishlist.notepad.products.length:0;d.$serviceBarCounter.html(t),d.$sbProductCounter.html(t),0==t?(s.removeClass("filled").addClass("empty"),d.$sbProductPlural.show()):1==t?(s.addClass("filled").removeClass("empty"),d.$sbProductPlural.hide()):(s.addClass("filled").removeClass("empty"),d.$sbProductPlural.show()),n.populateShortlist(t)},initServicebarHandlers:function(){s.on("click",".showDetails",function(t){s.hasClass("empty")&&t.preventDefault()}).on("click",".wishlist, .closeServicebar",function(e){e.preventDefault(),window.innerWidth>768?s.hasClass("open")?m.closeServicebar(e):m.openServicebar(e):window.location=t(".servicebarContent .showDetails").attr("href")}).on("click",".wlDelete",function(e){e.preventDefault(),p.deleteFromList(t(this).data("product-id"))}),t(".memo .memorize .memorable").on("click",function(e){e.preventDefault(),p.addToList(p.getProductData(this)),o.updateButtons(t(this).closest(".memo"))}),t(".memo .memorize .memorized").on("click",function(e){e.preventDefault(),p.deleteFromList(t(this).closest(".memo").data("product-id"))}),window.addEventListener("memo_add",function(t){p.addToList(t.detail)}),window.addEventListener("memo_delete",function(t){p.deleteFromList(t.detail.productId)}),window.addEventListener("pcomp_btn_update",function(){t(".contentColumn .product-comparison-toggle.uncompare").length===t(".contentColumn .product-comparison-toggle").length?t(".wlNav .product-comparison-all").removeClass("compare").addClass("uncompare").find(".text").html(t(".wlNav .product-comparison-all").attr("data-compared-text")):t(".wlNav .product-comparison-all").removeClass("uncompare").addClass("compare").find(".text").html(t(".wlNav .product-comparison-all").attr("data-compare-text"))}),window.addEventListener("servicebar_new_popup",function(e){t(".serviceUl .wishlist").removeClass("highlight"),t(".wishlistPopup-arrow").stop(!0,!1).fadeOut(300),t(".wishlistPopup").stop(!0,!1).fadeOut(300)}),t("html").on("click",".servicebar-visible > div",function(e){e.preventDefault(),t(e.target).closest(s).length||t(e.target).closest(".memorize").length||!s.hasClass("open")||m.closeServicebar(e)}),t(".wlProducts").on("mouseenter touchstart",".notAvailable",function(e){e.preventDefault(),t(this).find(".notAvailableNotice").fadeIn(300)}).on("mouseleave touchend",".notAvailable",function(e){e.preventDefault(),t(this).find(".notAvailableNotice").fadeOut(300)})},initClickHandlersAjaxContent:function(e){d.$notepadArea.on("click",".memorable",function(e){e.preventDefault(),p.addToList(p.getProductData(this)),o.updateButtons(t(this).closest(".memo"))}).on("click",".memorized",function(e){e.preventDefault(),p.deleteFromList(t(this).closest(".memo").data("product-id"))})}};return window.attachEvent?window.attachEvent("onstorage",p.storageEventNotebookCheck):window.addEventListener("storage",p.storageEventNotebookCheck,!1),t(document).on("changeWishlist",function(e){var i=wishlist.notepad.products?wishlist.notepad.products.length:0;t(".wlCount span").text(i),m.updateWishlistBar(),p.reInit()}),t(document).on("basicFilterReload",function(){o.updateButtons()}),t(document).on("productToWishlist",function(){o.showPopupEvent(),t(".serviceUl .wishlist").addClass("highlight"),t(".wishlistPopup-arrow").stop(!0,!1).hide().show(),t(".wishlistPopup").stop(!0,!1).hide().show().animate({opacity:1},5e3,"linear",function(){t(".wishlistPopup-arrow").hide(),t(this).hide(),t(".serviceUl .wishlist").removeClass("highlight")}),m.updateWishlistBar()}).on("productRemoveFromWishlist",function(){t(".serviceUl .wishlist").removeClass("highlight"),t(".wishlistPopup-arrow").stop(!0,!1).hide(),t(".wishlistPopup").stop(!0,!1).hide(),m.updateWishlistBar()}),t("form#wishListMailForm").submit(function(t){i(t,this)}),p});