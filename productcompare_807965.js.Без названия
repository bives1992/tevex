!function(t,o){"use strict";"function"==typeof define&&define.amd?define("productCompare",["jquery","iTim"],o):o(t.jQuery)}(this,function(t,o){return function(){function e(){var t=localStorage.getItem("productCompare");return t?JSON.parse(t):{timestamp:Date.now()}}function i(){k.timestamp=Date.now(),localStorage.setItem("productCompare",JSON.stringify(k)),a()}function a(){t("#servicebar .comparison-tab .count").html(d())}function n(t,o,e,i){try{window.trackingGoogle.trackEvent(t,e,o)}catch(t){}}function r(o){var e=Object.assign({},k[_]);for(var a in o)o.hasOwnProperty(a)&&(void 0!==e[a]?o[a].forEach(function(o){if(e[a].ids.indexOf(o)<0){var i=t('.product-comparison-toggle[data-product-id="'+o+'"]');t(".main").hasClass("product_detail_page")?n("Product Detail","AddToProductComparison",t("h1").text()):t(".main").hasClass("product_list_page")?n("Product List","AddToProductComparison",t(i).parents(".product_short_module").find("h2 a").text()):t(i).parents(".wishlist_page").length>0&&n("Memo List","AddToProductComparison",t(i).parents(".product_short_module").find("h2 a").text());var r=e[a].ids.slice(0);r.unshift(o),e[a].ids=r,e[a].timestamp=Date.now()}}):e[a]={timestamp:Date.now(),ids:o[a]});g(e),i(),P(),c(m(),!0)}function s(o){return t(o).clone().children().remove().end().text().length}function c(o,e){v(),clearTimeout(L),t("#servicebar .comparison-tab").removeClass("highlight"),t(D).fadeOut(200,function(){p(),t(o).show(),t("#servicebar .comparison-tab").addClass("highlight"),t(".comparison-tab-popup-arrow").stop(!0,!1).hide().show().animate({opacity:1},300,"linear"),t(D).stop(!0,!1).hide().show().animate({opacity:1},300,"linear",function(){if(e){var i=50*s(o);t(o).has("a").length>0&&(i+=1500),i>7e3?i=7e3:i<2e3&&(i=2e3),L=setTimeout(function(){t(".comparison-tab-popup-arrow").stop(!0,!1).animate({opacity:0},700,function(){t(this).hide()}),t(D).stop(!0,!1).animate({opacity:0},700,function(){t(this).hide()}),t("#servicebar .comparison-tab").removeClass("highlight")},i)}})})}function p(){t(D).find(".text").hide()}function d(){var t=O(),o=0;for(var e in t)t.hasOwnProperty(e)&&(o+=t[e].ids.length);return o}function u(){var t=O(),o=0;for(var e in t)if(t.hasOwnProperty(e)){var i=t[e].ids.length;i>o&&(o=i)}return o}function m(){var t=d(),o=u();return 0===t?x.EMPTY:o<2?x.SINGLE:o>=2?x.READY:void 0}function h(){t("#servicebar .comparison-tab-popup .close").click(function(){t("#servicebar .comparison-tab").removeClass("highlight"),t(".comparison-tab-popup-arrow").stop(!0,!1).animate({opacity:0},300,function(){t(this).hide()}),t(D).stop(!0,!1).animate({opacity:0},300,function(){t(this).hide()})})}function f(){t("#servicebar .comparison-tab .tabWrapper").click(function(){d()>1?window.location.href=t("#CompareFlyout-Ready a").attr("href"):c(m())})}function l(t){var o=O();for(var e in t)t.hasOwnProperty(e)&&o.hasOwnProperty(e)&&(o[e].ids=o[e].ids.filter(function(o){return t[e].indexOf(o)<0}),o[e].timestamp=Date.now(),0===o[e].ids.length&&delete o[e]);g(o),i(),P()}function v(){var t=new CustomEvent("servicebar_new_popup");window.dispatchEvent(t)}function w(t){var o=O();delete o[t],g(o),i(),P()}function g(t){k[_]=t}function O(){var t=k[_];return void 0!==t?t:{}}function y(t,o){p();var e=O();return Object.keys(e).length<=E?e.hasOwnProperty(t)?e[t].ids.length+o<=T?{isOk:!0}:{isOk:!1,msg:x.PRODUCTGROUPLIMIT,noOfProductsOk:T-e[t].ids.length}:o<=T?{isOk:!0}:{isOk:!1,msg:x.PRODUCTGROUPLIMIT,noOfProductsOk:T}:e.hasOwnProperty(t)?e[t].ids.length+o<=T?{isOk:!0}:{isOk:!1,msg:x.PRODUCTGROUPLIMIT,noOfProductsOk:T-e[t].ids.length}:{isOk:!1,msg:x.LISTSLIMIT,noOfProductsOk:0}}function C(){t(".product-comparison-toggle").click(function(){var o=t(this),e=t(this).data("compare-id"),i=t(this).data("product-id");const a={};if(a[e]=[i],o.hasClass("compare")){var n=y(e,1);n.isOk?r(a):c(n.msg,!0)}else o.hasClass("uncompare")&&l(a)}),h(),f(!1),window.addEventListener("pcomp_delete",function(t){l(t.detail)}),window.addEventListener("pcomp_add",function(t){r(t.detail)}),window.addEventListener("pcomp_delete_group",function(t){w(t.detail.compareId)}),window.addEventListener("servicebar_new_popup",function(o){clearTimeout(L),t("#servicebar .comparison-tab").removeClass("highlight"),t(".comparison-tab-popup-arrow").stop(!0,!1).animate({opacity:0},300,function(){t(this).hide()}),t(D).stop(!0,!1).animate({opacity:0},300,function(){t(this).hide(),p()})}),window.attachEvent?window.attachEvent("onstorage",b):window.addEventListener("storage",b,!1)}function b(t){t=t||window.event,"productCompare"===t.key&&(k=JSON.parse(t.newValue),P(),a())}function P(){var o=O();t.each(t(".product-comparison-toggle"),function(e,i){var a=t(i).data("compare-id"),n=t(i).data("product-id");o.hasOwnProperty(a)&&o[a].ids.indexOf(n)>=0?(t(i).removeClass("compare"),t(i).addClass("uncompare"),t(i).find(".text").html(t(i).attr("data-compared-text"))):(t(i).removeClass("uncompare"),t(i).addClass("compare"),t(i).find(".text").html(t(i).attr("data-compare-text")))});var e=new CustomEvent("pcomp_btn_update");window.dispatchEvent(e)}var L,T=7,E=7,I={},k={},_="",D=t("#servicebar .comparison-tab-popup"),x=(t("#servicebar .comparison-tab-popup .button"),{EMPTY:t("#CompareFlyout-Empty"),SINGLE:t("#CompareFlyout-Single"),READY:t("#CompareFlyout-Ready"),PRODUCTGROUPLIMIT:t("#CompareFlyout-OverProductsPerListLimit"),LISTSLIMIT:t("#CompareFlyout-OverMaxListLimit")});return{init:function(){k=e(),I=k,((Date.now()-k.timestamp)/864e5>1||!k.hasOwnProperty("timestamp"))&&(localStorage.removeItem("productCompare"),k={timestamp:Date.now()},I=k),_=o.url(window.location.href).directories[1],k[_]=O(),a(),C(),P()},update:function(){C(),P()}}}()});